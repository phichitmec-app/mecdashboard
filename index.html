<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedSchool Insight Dashboard</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Sarabun', 'sans-serif'] },
                    colors: {
                        brand: {
                            50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 
                            600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .tab-btn.active {
            background-color: #eff6ff; color: #1d4ed8; border-bottom: 2px solid #2563eb; font-weight: 600;
        }
        .tab-btn { transition: all 0.2s ease; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex flex-col min-h-screen">

<header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md shadow-sm border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center py-4 gap-4">
                
                <div class="flex items-center gap-3 select-none">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-brand-600 to-brand-800 flex items-center justify-center text-white shadow-lg">
                        <i class="fa-solid fa-user-md text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-slate-800 leading-tight">MedSchool <span class="text-brand-600">Insight</span></h1>
                        <p class="text-xs text-slate-500 font-medium tracking-wide">SYSTEM DASHBOARD</p>
                    </div>
                </div>

                <div class="bg-slate-100/50 p-1.5 rounded-xl border border-slate-200 flex flex-wrap items-center gap-2">
                    
                    <div class="px-3 py-1 text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
                        <i class="fa-solid fa-filter"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:
                    </div>
                    
                    <label class="cursor-pointer group relative">
                        <input type="checkbox" class="status-filter peer sr-only" value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤" checked>
                        <div class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-500 bg-white border border-slate-200 transition-all peer-checked:bg-blue-100 peer-checked:text-blue-700 peer-checked:border-blue-200 hover:bg-slate-50">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>
                    </label>
                    <label class="cursor-pointer group relative">
                        <input type="checkbox" class="status-filter peer sr-only" value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏ô" checked>
                        <div class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-500 bg-white border border-slate-200 transition-all peer-checked:bg-green-100 peer-checked:text-green-700 peer-checked:border-green-200 hover:bg-slate-50">‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏ô</div>
                    </label>
                    <label class="cursor-pointer group relative">
                        <input type="checkbox" class="status-filter peer sr-only" value="‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤" checked>
                        <div class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-500 bg-white border border-slate-200 transition-all peer-checked:bg-purple-100 peer-checked:text-purple-700 peer-checked:border-purple-200 hover:bg-slate-50">‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>
                    </label>
                    <label class="cursor-pointer group relative">
                        <input type="checkbox" class="status-filter peer sr-only" value="‡∏•‡∏≤‡∏≠‡∏≠‡∏Å" checked>
                        <div class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-500 bg-white border border-slate-200 transition-all peer-checked:bg-red-100 peer-checked:text-red-700 peer-checked:border-red-200 hover:bg-slate-50">‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</div>
                    </label>
                    
                    <div class="h-6 w-px bg-slate-300 mx-2 hidden sm:block"></div>

                    <div class="flex items-center gap-2">
                        <div class="text-xs font-bold text-slate-400 uppercase tracking-wider whitespace-nowrap">
                            <i class="fa-regular fa-calendar"></i> ‡∏£‡∏∏‡πà‡∏ô:
                        </div>
                        
                        <div class="relative group-year-filter">
                            <button id="year-dropdown-btn" class="flex items-center justify-between gap-2 bg-white border border-slate-200 text-slate-600 py-1.5 px-3 rounded-lg text-sm hover:border-brand-500 focus:ring-1 focus:ring-brand-500 transition min-w-[120px]">
                                <span id="year-btn-text">‡∏ó‡∏∏‡∏Å‡∏£‡∏∏‡πà‡∏ô (All)</span>
                                <i class="fa-solid fa-chevron-down text-xs text-slate-400"></i>
                            </button>

                            <div id="year-dropdown-panel" class="hidden absolute top-full right-0 mt-2 w-48 bg-white border border-slate-200 shadow-xl rounded-xl z-[60] overflow-hidden">
                                <div class="px-3 py-2 bg-slate-50 border-b border-slate-100 flex justify-between items-center text-xs">
                                    <button id="btn-check-all" class="text-brand-600 hover:underline font-medium">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                                    <button id="btn-clear-all" class="text-slate-400 hover:text-slate-600">‡∏•‡πâ‡∏≤‡∏á</button>
                                </div>
                                <div id="year-checkbox-container" class="max-h-60 overflow-y-auto p-2 space-y-1">
                                    </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="flex items-center gap-1 mt-2 overflow-x-auto no-scrollbar">
                <button onclick="switchTab('overview')" id="btn-overview" class="tab-btn active flex items-center gap-2 px-6 py-3 text-sm font-medium text-slate-500 hover:text-brand-600 hover:bg-slate-50 rounded-t-lg border-b-2 border-transparent">
                    <i class="fa-solid fa-chart-pie"></i><span>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</span>
                </button>
                <button onclick="switchTab('academic')" id="btn-academic" class="tab-btn flex items-center gap-2 px-6 py-3 text-sm font-medium text-slate-500 hover:text-brand-600 hover:bg-slate-50 rounded-t-lg border-b-2 border-transparent">
                    <i class="fa-solid fa-medal"></i><span>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô & NL</span>
                </button>
                <button onclick="switchTab('profile')" id="btn-profile" class="tab-btn flex items-center gap-2 px-6 py-3 text-sm font-medium text-slate-500 hover:text-brand-600 hover:bg-slate-50 rounded-t-lg border-b-2 border-transparent">
                    <i class="fa-solid fa-users-viewfinder"></i><span>‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</span>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
        
        <div id="loading" class="flex flex-col items-center justify-center py-24 fade-in">
            <div class="w-16 h-16 border-4 border-slate-200 border-t-brand-600 rounded-full animate-spin"></div>
            <p class="mt-4 text-slate-500 font-medium animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Supabase...</p>
        </div>

        <div id="tab-overview" class="tab-content hidden fade-in space-y-8">
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                
                <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100 border-l-4 border-l-slate-500">
                    <p class="text-slate-500 text-xs font-bold uppercase tracking-wider">‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    <h3 class="text-2xl font-bold text-slate-800 mt-1" id="kpi-total">0</h3>
                    <div class="mt-2 text-xs text-slate-400 text-right"><i class="fa-solid fa-users"></i> Total</div>
                </div>
                
                <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100 border-l-4 border-l-blue-500">
                    <p class="text-blue-600 text-xs font-bold uppercase tracking-wider">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
                    <h3 class="text-2xl font-bold text-slate-800 mt-1" id="kpi-studying">0</h3>
                    <div class="mt-2 text-xs text-slate-400 text-right"><i class="fa-solid fa-book-open"></i> Studying</div>
                </div>

                <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100 border-l-4 border-l-green-500">
                    <p class="text-green-600 text-xs font-bold uppercase tracking-wider">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏ô</p>
                    <h3 class="text-2xl font-bold text-slate-800 mt-1" id="kpi-intern">0</h3>
                    <div class="mt-2 text-xs text-slate-400 text-right"><i class="fa-solid fa-user-doctor"></i> Intern</div>
                </div>

                <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100 border-l-4 border-l-purple-500">
                    <p class="text-purple-600 text-xs font-bold uppercase tracking-wider">‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
                    <h3 class="text-2xl font-bold text-slate-800 mt-1" id="kpi-grad">0</h3>
                    <div class="mt-2 text-xs text-slate-400 text-right"><i class="fa-solid fa-graduation-cap"></i> Alumni</div>
                </div>

                <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100 border-l-4 border-l-red-400">
                    <p class="text-red-500 text-xs font-bold uppercase tracking-wider">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</p>
                    <h3 class="text-2xl font-bold text-slate-800 mt-1" id="kpi-dropout-count">0</h3>
                    <div class="mt-2 text-xs text-slate-400 text-right"><i class="fa-solid fa-user-xmark"></i> Drop-out</div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6">
                <h4 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                    <i class="fa-regular fa-calendar text-brand-500"></i> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏£‡∏∏‡πà‡∏ô (Cohort)
                </h4>
                <div id="chart-years" class="h-80"></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6">
                    <h4 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-chart-pie text-brand-500"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                    </h4>
                    <div id="chart-status" class="h-64 flex items-center justify-center"></div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6">
                    <h4 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-heart-pulse text-brand-500"></i> ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤
                    </h4>
                    <div id="chart-rights" class="h-64 flex items-center justify-center"></div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6">
                    <h4 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-sack-dollar text-brand-500"></i> ‡∏ó‡∏∏‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                    </h4>
                    <div id="chart-scholarship-type" class="h-64 flex items-center justify-center"></div>
                </div>
            </div>

             <div class="grid grid-cols-1 gap-6">
                <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6">
                    <h4 class="font-bold text-slate-700 mb-4 flex items-center gap-2"><i class="fa-solid fa-map-location-dot text-brand-500"></i> 10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏ô</h4>
                    <div id="chart-province" class="h-80"></div>
                </div>
            </div>
        </div>

<div id="tab-academic" class="tab-content hidden fade-in space-y-8">
            
            <div>
                <h3 class="text-lg font-bold text-slate-700 mb-4 border-l-4 border-brand-500 pl-3">
                    ‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û‡πÄ‡∏ß‡∏ä‡∏Å‡∏£‡∏£‡∏° (National License)
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100 flex items-center justify-between">
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase">NL1 Pass Rate</p>
                            <h4 class="text-2xl font-bold text-brand-600 mt-1" id="kpi-nl1">0%</h4>
                        </div>
                        <div class="h-10 w-10 rounded-full bg-brand-50 flex items-center justify-center text-brand-500"><i class="fa-solid fa-brain"></i></div>
                    </div>
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100 flex items-center justify-between">
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase">NL2 Pass Rate</p>
                            <h4 class="text-2xl font-bold text-indigo-600 mt-1" id="kpi-nl2">0%</h4>
                        </div>
                        <div class="h-10 w-10 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-500"><i class="fa-solid fa-user-doctor"></i></div>
                    </div>
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100 flex items-center justify-between">
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase">NL3 (OSCE)</p>
                            <h4 class="text-2xl font-bold text-purple-600 mt-1" id="kpi-nl3">0%</h4>
                        </div>
                        <div class="h-10 w-10 rounded-full bg-purple-50 flex items-center justify-center text-purple-500"><i class="fa-solid fa-clipboard-check"></i></div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6">
                    <h4 class="font-bold text-slate-700 mb-4 text-sm"><i class="fa-solid fa-chart-simple text-brand-500 mr-2"></i> ‡∏ú‡∏•‡∏™‡∏≠‡∏ö NL ‡πÅ‡∏¢‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ (‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)</h4>
                    <div id="chart-nl-detail" class="h-80"></div>
                </div>
            </div>

            <hr class="border-slate-200">

            <div>
                <h3 class="text-lg font-bold text-slate-700 mb-4 border-l-4 border-orange-500 pl-3">
                    ‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏£‡∏ß‡∏ö‡∏¢‡∏≠‡∏î (Comprehensive Exam)
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100 flex items-center justify-between">
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase">CE1 Pass Rate</p>
                            <h4 class="text-2xl font-bold text-orange-600 mt-1" id="kpi-ce1">0%</h4>
                        </div>
                        <div class="h-10 w-10 rounded-full bg-orange-50 flex items-center justify-center text-orange-500">1</div>
                    </div>
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100 flex items-center justify-between">
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase">CE2 Pass Rate</p>
                            <h4 class="text-2xl font-bold text-orange-600 mt-1" id="kpi-ce2">0%</h4>
                        </div>
                        <div class="h-10 w-10 rounded-full bg-orange-50 flex items-center justify-center text-orange-500">2</div>
                    </div>
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-100 flex items-center justify-between">
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase">CE3 (OSCE)</p>
                            <h4 class="text-2xl font-bold text-orange-600 mt-1" id="kpi-ce3">0%</h4>
                        </div>
                        <div class="h-10 w-10 rounded-full bg-orange-50 flex items-center justify-center text-orange-500">3</div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6">
                    <h4 class="font-bold text-slate-700 mb-4 text-sm"><i class="fa-solid fa-list-check text-orange-500 mr-2"></i> ‡∏ú‡∏•‡∏™‡∏≠‡∏ö CE ‡πÅ‡∏¢‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ (‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)</h4>
                    <div id="chart-ce-detail" class="h-80"></div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden mt-8">
                <div class="p-4 border-b border-slate-100 bg-slate-50/50 flex flex-col sm:flex-row justify-between items-center gap-4">
                    <h4 class="font-bold text-slate-800"><i class="fa-solid fa-table-list text-slate-500 mr-2"></i> ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏•‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h4>
                    
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-bold text-slate-500 uppercase">‡∏Å‡∏£‡∏≠‡∏á‡∏ú‡∏•‡∏™‡∏≠‡∏ö:</span>
                        <select id="exam-result-filter" class="bg-white border border-slate-300 text-slate-700 text-xs rounded-lg py-1.5 px-3 focus:outline-none focus:border-brand-500 shadow-sm cursor-pointer">
                            <option value="all">‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="fail" class="text-red-600 font-bold">‚ö†Ô∏è ‡∏°‡∏µ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà "‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô"</option>
                            <option value="pass" class="text-green-600 font-bold">‚úÖ ‡∏°‡∏µ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà "‡∏ú‡πà‡∏≤‡∏ô"</option>
                        </select>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-200 text-xs">
                        <thead class="bg-slate-100 text-slate-700">
                            <tr>
                                <th class="px-3 py-3 text-left font-bold sticky left-0 bg-slate-100 z-10 w-20">‡∏£‡∏∏‡πà‡∏ô</th>
                                <th class="px-3 py-3 text-left font-bold sticky left-20 bg-slate-100 z-10 w-40 border-r border-slate-200">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                                
                                <th class="px-2 py-3 text-center font-bold bg-blue-50 text-blue-700">NL1</th>
                                <th class="px-2 py-3 text-center font-bold bg-blue-50 text-blue-700">NL2</th>
                                <th class="px-2 py-3 text-center font-bold bg-blue-50 text-blue-700">NL3 OSCE</th>
                                <th class="px-2 py-3 text-center font-bold bg-blue-50 text-blue-700">NL3 MEQ</th>
                                <th class="px-2 py-3 text-center font-bold bg-blue-50 text-blue-700 border-r border-slate-200">NL3 Longcase</th>
                                
                                <th class="px-2 py-3 text-center font-bold bg-orange-50 text-orange-700">CE1</th>
                                <th class="px-2 py-3 text-center font-bold bg-orange-50 text-orange-700">CE2</th>
                                <th class="px-2 py-3 text-center font-bold bg-orange-50 text-orange-700">CE3 OSCE</th>
                                <th class="px-2 py-3 text-center font-bold bg-orange-50 text-orange-700">CE3 MEQ</th>
                            </tr>
                        </thead>
                        <tbody id="exam-table-body" class="bg-white divide-y divide-slate-100">
                            </tbody>
                    </table>
		<div class="p-4 bg-slate-50 border-t border-slate-100 flex flex-col sm:flex-row justify-between items-center gap-4">
                    <div class="flex items-center gap-2 text-xs text-slate-500">
                        <span>‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ñ‡∏ß:</span>
                        <select id="rows-per-page-academic" class="bg-white border border-slate-300 text-slate-700 text-xs rounded py-1 px-2 focus:outline-none focus:border-brand-500">
                            <option value="10">10</option>
                            <option value="20" selected>20</option>
                            <option value="30">30</option>
                            <option value="40">40</option>
                            <option value="50">50</option>
                        </select>
                        <span id="table-info-academic">‡πÅ‡∏™‡∏î‡∏á 0-0 ‡∏à‡∏≤‡∏Å 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                    </div>

                    <div class="flex items-center gap-2">
                        <button id="btn-prev-academic" class="px-3 py-1 rounded border border-slate-300 bg-white text-slate-600 hover:bg-slate-100 disabled:opacity-50 text-xs font-medium transition">
                            <i class="fa-solid fa-chevron-left mr-1"></i> ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                        </button>
                        <span id="page-display-academic" class="text-xs font-bold text-slate-700 px-2">‡∏´‡∏ô‡πâ‡∏≤ 1</span>
                        <button id="btn-next-academic" class="px-3 py-1 rounded border border-slate-300 bg-white text-slate-600 hover:bg-slate-100 disabled:opacity-50 text-xs font-medium transition">
                            ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ <i class="fa-solid fa-chevron-right ml-1"></i>
                        </button>
                    </div>
                </div>
            </div>                 </div>
                <div class="p-3 bg-slate-50 text-center text-xs text-slate-400">
                    ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠)
                </div>
            </div>

        </div>


        <div id="tab-profile" class="tab-content hidden fade-in space-y-6">
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                
                <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6">
                    <h4 class="font-bold text-slate-700 mb-4 text-sm flex items-center gap-2">
                        <i class="fa-solid fa-stethoscope text-brand-500"></i> 10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡πà‡∏≠
                    </h4>
                    <div id="chart-major" class="h-80"></div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6">
                    <h4 class="font-bold text-slate-700 mb-4 text-sm flex items-center gap-2">
                        <i class="fa-solid fa-university text-brand-500"></i> 10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢
                    </h4>
                    <div id="chart-university" class="h-80"></div>
                </div>

            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">

            <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="p-6 border-b border-slate-100 flex flex-col md:flex-row justify-between items-center gap-4">
                    <h4 class="font-bold text-slate-800 text-lg"><i class="fa-solid fa-list text-brand-500 mr-2"></i> ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</h4>
                    <div class="relative w-full md:w-72">
                        <input type="text" id="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏ä‡∏∑‡πà‡∏≠, ‡∏£‡∏´‡∏±‡∏™, ‡∏£‡∏∏‡πà‡∏ô..." 
                               class="w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:border-brand-500 text-sm">
                        <i class="fa-solid fa-search absolute left-3 top-2.5 text-slate-400"></i>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-200 text-sm">
                        <thead class="bg-slate-50/80">
                            <tr>
                                <th class="px-6 py-3 text-left font-semibold text-slate-600">‡∏£‡∏∏‡πà‡∏ô</th>
                                <th class="px-6 py-3 text-left font-semibold text-slate-600">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</th>
                                <th class="px-6 py-3 text-left font-semibold text-slate-600">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                                <th class="px-6 py-3 text-left font-semibold text-slate-600">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</th>
                                <th class="px-6 py-3 text-left font-semibold text-slate-600">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏£‡∏±‡∏Å‡∏©‡∏≤</th>
                                <th class="px-6 py-3 text-left font-semibold text-slate-600">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏ô</th>
                                <th class="px-6 py-3 text-left font-semibold text-slate-600">‡∏™‡∏≤‡∏Ç‡∏≤</th>
                                <th class="px-6 py-3 text-left font-semibold text-slate-600">‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢</th>
                                <th class="px-6 py-3 text-center font-semibold text-slate-600">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            </tr>
                        </thead>
                        <tbody id="table-body" class="bg-white divide-y divide-slate-100">
                            </tbody>
                    </table>
                </div>

                <div class="p-4 bg-slate-50 border-t border-slate-100 flex flex-col sm:flex-row justify-between items-center gap-4">
                    <div class="flex items-center gap-2 text-xs text-slate-500">
                        <span>‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ñ‡∏ß:</span>
                        <select id="rows-per-page-profile" class="bg-white border border-slate-300 text-slate-700 text-xs rounded py-1 px-2 focus:outline-none focus:border-brand-500">
                            <option value="10">10</option>
                            <option value="20" selected>20</option>
                            <option value="30">30</option>
                            <option value="40">40</option>
                            <option value="50">50</option>
                        </select>
                        <span id="table-info-profile">‡πÅ‡∏™‡∏î‡∏á 0-0 ‡∏à‡∏≤‡∏Å 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                    </div>

                    <div class="flex items-center gap-2">
                        <button id="btn-prev-profile" class="px-3 py-1 rounded border border-slate-300 bg-white text-slate-600 hover:bg-slate-100 disabled:opacity-50 text-xs font-medium transition">
                            <i class="fa-solid fa-chevron-left mr-1"></i> ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                        </button>
                        <span id="page-display-profile" class="text-xs font-bold text-slate-700 px-2">‡∏´‡∏ô‡πâ‡∏≤ 1</span>
                        <button id="btn-next-profile" class="px-3 py-1 rounded border border-slate-300 bg-white text-slate-600 hover:bg-slate-100 disabled:opacity-50 text-xs font-medium transition">
                            ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ <i class="fa-solid fa-chevron-right ml-1"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-slate-900 text-slate-300 py-6 border-t-4 border-brand-600 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-xs text-slate-500">&copy; 2024 MedSchool Dashboard. System v3.0</p>
        </div>
    </footer>

    <script>
        // --- 1. CONFIGURATION ---
        const SUPABASE_URL = 'https://blpdvcktvegmbizmebjk.supabase.co'; // üî¥ ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJscGR2Y2t0dmVnbWJpem1lYmprIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyODcwNzIsImV4cCI6MjA4Mzg2MzA3Mn0.N8ZHXZAf30nhzU0dBbPEFpmGaXDAN4jwSSK_fM6_TBc'; // üî¥ ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        const TABLE_NAME = 'mec_student';

        const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Global State
        let allData = [];
        let filteredData = [];
        let charts = {};
	let examResultFilter = 'all'; // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        
        // Pagination State (‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô 2 ‡∏´‡∏ô‡πâ‡∏≤)
        let pageAcademic = 1;
        let rowsAcademic = 20; // Default 20

        let pageProfile = 1;
        let rowsProfile = 20;  // Default 20

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', async () => {
            await fetchData();
            switchTab('overview');
            
            // Listeners
            document.querySelectorAll('.status-filter').forEach(cb => cb.addEventListener('change', updateDashboard));

            // --- Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Custom Dropdown ---
            const yearBtn = document.getElementById('year-dropdown-btn');
            const yearPanel = document.getElementById('year-dropdown-panel');

            // 1. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠ ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Panel
            yearBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                yearPanel.classList.toggle('hidden');
            });

            // 2. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î Panel
            document.addEventListener('click', (e) => {
                if (!yearBtn.contains(e.target) && !yearPanel.contains(e.target)) {
                    yearPanel.classList.add('hidden');
                }
            });

            // 3. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"
            document.getElementById('btn-check-all').addEventListener('click', () => {
                document.querySelectorAll('.year-checkbox').forEach(cb => cb.checked = true);
                updateDashboard();
            });

            // 4. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏•‡πâ‡∏≤‡∏á"
            document.getElementById('btn-clear-all').addEventListener('click', () => {
                document.querySelectorAll('.year-checkbox').forEach(cb => cb.checked = false);
                updateDashboard();
            });

            // 5. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡πä‡∏Å Checkbox ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß ‡πÉ‡∏´‡πâ update dashboard ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            // (‡πÉ‡∏ä‡πâ Event Delegation ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Checkbox ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á)
            document.getElementById('year-checkbox-container').addEventListener('change', (e) => {
                if(e.target.classList.contains('year-checkbox')) {
                    updateDashboard();
                }
            });
            
            document.getElementById('search-input').addEventListener('keyup', () => {
                currentPage = 1; // Reset to page 1 on search
                renderTable();            
            });
            
            // --- Pagination Listeners: Tab 2 (Academic) ---
            document.getElementById('btn-prev-academic').addEventListener('click', () => changePage('academic', -1));
            document.getElementById('btn-next-academic').addEventListener('click', () => changePage('academic', 1));
            document.getElementById('rows-per-page-academic').addEventListener('change', (e) => {
                rowsAcademic = parseInt(e.target.value);
                pageAcademic = 1; // Reset ‡∏´‡∏ô‡πâ‡∏≤
                renderExamTable(filteredData);
            });

	       // --- Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Filter ‡∏ú‡∏•‡∏™‡∏≠‡∏ö (Tab 2) üî¥ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà ---
            document.getElementById('exam-result-filter').addEventListener('change', (e) => {
                examResultFilter = e.target.value;
                pageAcademic = 1; // Reset ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ 1
                renderExamTable(filteredData);
            });

		

            // --- Pagination Listeners: Tab 3 (Profile) ---
            document.getElementById('btn-prev-profile').addEventListener('click', () => changePage('profile', -1));
            document.getElementById('btn-next-profile').addEventListener('click', () => changePage('profile', 1));
            document.getElementById('rows-per-page-profile').addEventListener('change', (e) => {
                rowsProfile = parseInt(e.target.value);
                pageProfile = 1; // Reset ‡∏´‡∏ô‡πâ‡∏≤
                renderTable();
            });
        });
	

        window.switchTab = function(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${tabName}`).classList.add('active');
            setTimeout(() => { window.dispatchEvent(new Event('resize')); }, 100);
        }


	// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡πÇ‡∏Ñ‡πâ‡∏î‡∏ã‡πâ‡∏≥)
        function changePage(tab, direction) {
            if (tab === 'academic') {
                pageAcademic += direction;
                renderExamTable(filteredData);
            } else if (tab === 'profile') {
                pageProfile += direction;
                renderTable();
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Checkbox ‡∏£‡∏∏‡πà‡∏ô
        function populateYearFilter() {
            const container = document.getElementById('year-checkbox-container');
            container.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤

            // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∏‡πà‡∏ô + Natural Sort
            const years = [...new Set(allData.map(d => d.stu_year))];
            const sortedYears = years
                .filter(y => y && y !== '-' && y !== '')
                .sort((a, b) => a.localeCompare(b, undefined, { numeric: true, sensitivity: 'base' }));

            // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Checkbox
            sortedYears.forEach(year => {
                const label = document.createElement('label');
                label.className = 'flex items-center gap-2 px-2 py-1.5 hover:bg-slate-50 rounded cursor-pointer text-sm text-slate-700';
                label.innerHTML = `
                    <input type="checkbox" class="year-checkbox form-checkbox h-4 w-4 text-brand-600 rounded border-slate-300" value="${year}" checked>
                    <span>${year}</span>
                `;
                container.appendChild(label);
            });
            
            updateYearButtonText(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°
        }

        async function fetchData() {
            try {
                const { data, error } = await db.from(TABLE_NAME).select('*');
                if (error) throw error;
                allData = data;
                populateYearFilter();
                document.getElementById('loading').classList.add('hidden');
                updateDashboard();
            } catch (err) {
                console.error(err);
                document.getElementById('loading').innerHTML = `<div class="text-red-500">Error: ${err.message}</div>`;
            }
        }

        function updateDashboard() {
            // 1. Status Checkbox
            const statusBoxes = document.querySelectorAll('.status-filter:checked');
            const selectedStatuses = Array.from(statusBoxes).map(cb => cb.value);

            // 2. Year Checkbox (Multi-select) üî¥ ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
            const yearBoxes = document.querySelectorAll('.year-checkbox:checked');
            const selectedYears = Array.from(yearBoxes).map(cb => cb.value);

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î
            updateYearButtonText(selectedYears.length, document.querySelectorAll('.year-checkbox').length);

            // 3. ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            filteredData = allData.filter(item => {
                const status = item.studystatus || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                const year = item.stu_year || '';

                const matchStatus = selectedStatuses.includes(status);
                
                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏£‡∏∏‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏´‡∏° üî¥
                const matchYear = selectedYears.includes(year);

                return matchStatus && matchYear;
            });

            // Reset Pagination ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Filter
            pageAcademic = 1;
            pageProfile = 1;

            renderTab1_Overview(filteredData);
            renderTab2_Academic(filteredData);
            renderTab3_Profile(filteredData);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°
        function updateYearButtonText(selectedCount, totalCount) {
            const btnText = document.getElementById('year-btn-text');
            if (!btnText) return;
            
            // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏°‡∏≤ ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏ô‡∏±‡∏ö‡πÄ‡∏≠‡∏á
            if (selectedCount === undefined) {
                selectedCount = document.querySelectorAll('.year-checkbox:checked').length;
                totalCount = document.querySelectorAll('.year-checkbox').length;
            }

            if (selectedCount === totalCount || totalCount === 0) {
                btnText.innerText = `‡∏ó‡∏∏‡∏Å‡∏£‡∏∏‡πà‡∏ô (${totalCount})`;
                btnText.classList.remove('text-brand-600', 'font-bold');
            } else if (selectedCount === 0) {
                btnText.innerText = '‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∏‡πà‡∏ô';
                btnText.classList.remove('text-brand-600', 'font-bold');
            } else {
                btnText.innerText = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ${selectedCount} ‡∏£‡∏∏‡πà‡∏ô`;
                btnText.classList.add('text-brand-600', 'font-bold'); // ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏™‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
            }
        }

        // --- TAB 1: OVERVIEW ---
       // --- TAB 1: OVERVIEW ---
        function renderTab1_Overview(data) {
            // 1. Total
            document.getElementById('kpi-total').innerText = data.length.toLocaleString();
            
            // 2. Studying (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤) üîµ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ô‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤
            const studying = data.filter(d => d.studystatus === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤').length;
            document.getElementById('kpi-studying').innerText = studying.toLocaleString();

            // 3. Intern (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏ô) üü¢ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ô‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏ô
            const intern = data.filter(d => d.studystatus === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏ô').length;
            document.getElementById('kpi-intern').innerText = intern.toLocaleString();

            // 4. Graduated (‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤)
            const grads = data.filter(d => d.studystatus === '‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤').length;
            document.getElementById('kpi-grad').innerText = grads.toLocaleString();

            // 5. Drop-out Count (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏•‡∏≤‡∏≠‡∏≠‡∏Å)
            const dropouts = data.filter(d => d.studystatus === '‡∏•‡∏≤‡∏≠‡∏≠‡∏Å').length;
            document.getElementById('kpi-dropout-count').innerText = dropouts.toLocaleString();

            // --- Charts ---

            // Chart 1: Cohort (Sorted Natural: NT-1 -> NT-10)
            const yearCounts = {};
            data.forEach(d => {
                let y = d.stu_year;
                if(!y || y === '-') return;
                yearCounts[y] = (yearCounts[y] || 0) + 1;
            });
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏ö‡∏ö Natural Sort (NT-1 ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô NT-10)
            const sortedYears = Object.keys(yearCounts).sort((a, b) => {
                return a.localeCompare(b, undefined, { numeric: true, sensitivity: 'base' });
            });
            const sortedCounts = sortedYears.map(y => yearCounts[y]);

            renderChart('chart-years', {
                series: [{ name: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï', data: sortedCounts }],
                chart: { type: 'bar', height: 300 },
                xaxis: { categories: sortedYears },
                colors: ['#3b82f6'],
                plotOptions: { bar: { columnWidth: '50%' } }
            });

            // Chart 2: Status
            const statusCounts = countByGroup(data, 'studystatus');
            renderChart('chart-status', {
                series: Object.values(statusCounts),
                labels: Object.keys(statusCounts),
                chart: { type: 'donut', height: 250 },
                colors: ['#3b82f6', '#10b981', '#a855f7', '#ef4444'],
                legend: { position: 'bottom' }
            });

            // Chart 3: Healthcare Rights
            const rightsCounts = countByGroup(data, 'healthcare_rights');
            renderChart('chart-rights', {
                series: Object.values(rightsCounts),
                labels: Object.keys(rightsCounts),
                chart: { type: 'donut', height: 250 },
                colors: ['#0ea5e9', '#6366f1', '#8b5cf6', '#d946ef', '#f43f5e'],
                legend: { position: 'bottom' }
            });

            // Chart 4: Scholarship Type
            const scholarTypeCounts = countByGroup(data, 'scholarship_type');
            renderChart('chart-scholarship-type', {
                series: Object.values(scholarTypeCounts),
                labels: Object.keys(scholarTypeCounts),
                chart: { type: 'pie', height: 250 },
                colors: ['#f59e0b', '#10b981', '#3b82f6', '#ef4444', '#64748b'],
                legend: { position: 'bottom' }
            });

            // Chart 5: Province
            const provCounts = countByGroup(data, 'scholarship_province', 20);
            renderChart('chart-province', {
                series: [{ name: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', data: Object.values(provCounts) }],
                chart: { type: 'bar', height: 600 },
                plotOptions: { bar: { horizontal: true, borderRadius: 4 } },
                xaxis: { categories: Object.keys(provCounts) },
                colors: ['#f59e0b']
            });
        }

        // --- TAB 2: ACADEMIC (UPDATED V.2) ---
        function renderTab2_Academic(data) {
            // Helper: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì % ‡∏ú‡πà‡∏≤‡∏ô
            const calcPassRate = (field) => {
                const takers = data.filter(d => d[field] && (d[field].startsWith('‡∏ú‡πà‡∏≤‡∏ô') || d[field].startsWith('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô')));
                if(takers.length === 0) return '0%';
                const pass = takers.filter(d => d[field].startsWith('‡∏ú‡πà‡∏≤‡∏ô')).length;
                return ((pass / takers.length) * 100).toFixed(1) + '%';
            }

            // 1. Update KPIs
            document.getElementById('kpi-nl1').innerText = calcPassRate('nl1');
            document.getElementById('kpi-nl2').innerText = calcPassRate('nl2');
            document.getElementById('kpi-nl3').innerText = calcPassRate('nl3osce'); 
            
            document.getElementById('kpi-ce1').innerText = calcPassRate('ce1');
            document.getElementById('kpi-ce2').innerText = calcPassRate('ce2');
            document.getElementById('kpi-ce3').innerText = calcPassRate('ce3osce'); 

            // 2. Chart: NL Details (5 Parts)
            const nlExams = ['nl1', 'nl2', 'nl3osce', 'nl3meq', 'nl3longcase'];
            const nlLabels = ['NL1', 'NL2', 'NL3 OSCE', 'NL3 MEQ', 'NL3 Longcase'];
            const nlPass = [], nlFail = [];

            nlExams.forEach(field => {
                const pass = data.filter(d => d[field] && d[field].startsWith('‡∏ú‡πà‡∏≤‡∏ô')).length;
                const fail = data.filter(d => d[field] && d[field].startsWith('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô')).length;
                nlPass.push(pass);
                nlFail.push(fail);
            });

            renderChart('chart-nl-detail', {
                series: [{ name: '‡∏ú‡πà‡∏≤‡∏ô', data: nlPass }, { name: '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô', data: nlFail }],
                chart: { type: 'bar', height: 320, stacked: true },
                xaxis: { categories: nlLabels },
                colors: ['#22c55e', '#ef4444'],
                plotOptions: { bar: { columnWidth: '40%', borderRadius: 4 } },
                legend: { position: 'top' }
            });

            // 3. Chart: CE Details (4 Parts)
            const ceExams = ['ce1', 'ce2', 'ce3osce', 'ce3meq'];
            const ceLabels = ['CE1', 'CE2', 'CE3 OSCE', 'CE3 MEQ'];
            const cePass = [], ceFail = [];

            ceExams.forEach(field => {
                const pass = data.filter(d => d[field] && d[field].startsWith('‡∏ú‡πà‡∏≤‡∏ô')).length;
                const fail = data.filter(d => d[field] && d[field].startsWith('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô')).length;
                cePass.push(pass);
                ceFail.push(fail);
            });

            renderChart('chart-ce-detail', {
                series: [{ name: '‡∏ú‡πà‡∏≤‡∏ô', data: cePass }, { name: '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô', data: ceFail }],
                chart: { type: 'bar', height: 320, stacked: true },
                xaxis: { categories: ceLabels },
                colors: ['#f97316', '#94a3b8'],
                plotOptions: { bar: { columnWidth: '40%', borderRadius: 4 } },
                legend: { position: 'top' }
            });

            // 4. Render Exam Table (New Section) üî¥
            renderExamTable(data);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏•‡∏™‡∏≠‡∏ö (‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏∞‡∏≠‡∏≤‡∏î)
       function renderExamTable(data) {
            const tbody = document.getElementById('exam-table-body');
            tbody.innerHTML = '';

            // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ
            const examFields = ['nl1', 'nl2', 'nl3osce', 'nl3meq', 'nl3longcase', 'ce1', 'ce2', 'ce3osce', 'ce3meq'];

            // 1. ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° Dropdown (Filter Logic) üî¥
            let displayData = data.filter(d => {
                if (examResultFilter === 'all') return true;

                if (examResultFilter === 'fail') {
                    // ‡∏Å‡∏è: ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏î‡∏ß‡∏¥‡∏ä‡∏≤‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ "‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô"
                    return examFields.some(field => d[field] && d[field].toString().startsWith('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô'));
                }

                if (examResultFilter === 'pass') {
                    // ‡∏Å‡∏è: ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏î‡∏ß‡∏¥‡∏ä‡∏≤‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ "‡∏ú‡πà‡∏≤‡∏ô"
                    return examFields.some(field => d[field] && d[field].toString().startsWith('‡∏ú‡πà‡∏≤‡∏ô'));
                }
                return true;
            });

            // 2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö (Sorting: ‡∏£‡∏∏‡πà‡∏ô -> ‡∏ä‡∏∑‡πà‡∏≠)
            displayData.sort((a, b) => {
                const yearA = a.stu_year || '';
                const yearB = b.stu_year || '';
                const yearCompare = yearA.localeCompare(yearB, undefined, { numeric: true, sensitivity: 'base' });
                if (yearCompare === 0) return (a.fullname || '').localeCompare(b.fullname || '', 'th');
                return yearCompare;
            });

            // 3. Pagination Logic
            const totalItems = displayData.length;
            const totalPages = Math.ceil(totalItems / rowsAcademic);

            if (pageAcademic > totalPages && totalPages > 0) pageAcademic = totalPages;
            if (pageAcademic < 1) pageAcademic = 1;

            const startIdx = (pageAcademic - 1) * rowsAcademic;
            const endIdx = startIdx + rowsAcademic;
            const pageItems = displayData.slice(startIdx, endIdx);

            // 4. Render Rows
            const getBadge = (text) => {
                if (!text || text === '-' || text === '') return '<span class="text-slate-300">-</span>';
                if (text.toString().startsWith('‡∏ú‡πà‡∏≤‡∏ô')) return `<span class="px-2 py-0.5 rounded-full bg-green-100 text-green-700 font-bold text-[10px] whitespace-nowrap">${text}</span>`;
                if (text.toString().startsWith('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô')) return `<span class="px-2 py-0.5 rounded-full bg-red-100 text-red-700 font-bold text-[10px] whitespace-nowrap">${text}</span>`;
                return `<span class="text-slate-500">${text}</span>`;
            };

            if (pageItems.length === 0) {
                tbody.innerHTML = `<tr><td colspan="11" class="text-center py-8 text-slate-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</td></tr>`;
            } else {
                pageItems.forEach(d => {
                    const tr = `
                        <tr class="hover:bg-slate-50 transition border-b border-slate-50 last:border-0">
                            <td class="px-3 py-2 font-medium text-slate-600 sticky left-0 bg-white z-0 border-r border-slate-100 shadow-sm">${d.stu_year || '-'}</td>
                            <td class="px-3 py-2 font-medium text-slate-800 sticky left-14 sm:left-16 bg-white z-0 border-r border-slate-100 shadow-sm whitespace-nowrap min-w-[150px]">${d.fullname || '-'}</td>
                            
                            <td class="px-2 py-2 text-center border-l border-slate-50">${getBadge(d.nl1)}</td>
                            <td class="px-2 py-2 text-center border-l border-slate-50">${getBadge(d.nl2)}</td>
                            <td class="px-2 py-2 text-center border-l border-slate-50">${getBadge(d.nl3osce)}</td>
                            <td class="px-2 py-2 text-center border-l border-slate-50">${getBadge(d.nl3meq)}</td>
                            <td class="px-2 py-2 text-center border-l border-slate-50 border-r border-slate-200 bg-slate-50/30">${getBadge(d.nl3longcase)}</td>

                            <td class="px-2 py-2 text-center border-l border-slate-50">${getBadge(d.ce1)}</td>
                            <td class="px-2 py-2 text-center border-l border-slate-50">${getBadge(d.ce2)}</td>
                            <td class="px-2 py-2 text-center border-l border-slate-50">${getBadge(d.ce3osce)}</td>
                            <td class="px-2 py-2 text-center border-l border-slate-50">${getBadge(d.ce3meq)}</td>
                        </tr>
                    `;
                    tbody.insertAdjacentHTML('beforeend', tr);
                });
            }

            // 5. Update Footer Controls
            document.getElementById('table-info-academic').innerText = totalItems > 0 
                ? `‡πÅ‡∏™‡∏î‡∏á ${startIdx + 1}-${Math.min(endIdx, totalItems)} ‡∏à‡∏≤‡∏Å ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`
                : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            document.getElementById('page-display-academic').innerText = `‡∏´‡∏ô‡πâ‡∏≤ ${totalPages > 0 ? pageAcademic : 0} / ${totalPages}`;
            document.getElementById('btn-prev-academic').disabled = pageAcademic === 1 || totalItems === 0;
            document.getElementById('btn-next-academic').disabled = pageAcademic === totalPages || totalItems === 0;
        }

        // --- TAB 3 ---
        function renderTab3_Profile(data) {
            // 1. Chart: Major (‡∏™‡∏≤‡∏Ç‡∏≤)
            // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏Ç‡∏≤ (‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏£‡∏ö)
            const majorCounts = countByGroup(data, 'major', 10);
            
            renderChart('chart-major', {
                series: [{ name: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', data: Object.values(majorCounts) }],
                chart: { type: 'bar', height: 350 }, // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≤‡∏ü‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏î‡πÅ‡∏ô‡πà‡∏ô
                plotOptions: { 
                    bar: { 
                        horizontal: true, 
                        borderRadius: 4,
                        barHeight: '70%', // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡πâ‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ó‡πà‡∏á‡∏Å‡∏£‡∏≤‡∏ü
                        dataLabels: { position: 'center' } // ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏•‡∏≤‡∏¢‡πÅ‡∏ó‡πà‡∏á
                    } 
                },
                xaxis: { categories: Object.keys(majorCounts) },
                colors: ['#0ea5e9'], // ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ Sky
                dataLabels: { 
                    enabled: true,
                    textAnchor: 'start',
                    style: { colors: ['#fff'] },
                    formatter: function (val, opt) {
                        return val > 0 ? val : '';
                    }
                }
            });

            // 2. Chart: University (‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢)
            const uniCounts = countByGroup(data, 'university', 10);

            renderChart('chart-university', {
                series: [{ name: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', data: Object.values(uniCounts) }],
                chart: { type: 'bar', height: 350 },
                plotOptions: { 
                    bar: { 
                        horizontal: true, 
                        borderRadius: 4,
                        barHeight: '70%'
                    } 
                },
                xaxis: { categories: Object.keys(uniCounts) },
                colors: ['#8b5cf6'], // ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á Violet
                 dataLabels: { position: 'center' }
            });

            // 3. Render Table (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
            renderTable();
        }

        // --- TABLE LOGIC ---
    // --- TABLE LOGIC ---
        function getTableMatches() {
            const search = document.getElementById('search-input').value.toLowerCase();
            
            // 1. ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (Search)
            let matches = filteredData.filter(d => {
                const text = `${d.student_id} ${d.fullname} ${d.nickname} ${d.stu_year} ${d.scholarship_province}`.toLowerCase();
                return text.includes(search);
            });

            // 2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Sorting)
            return matches.sort((a, b) => {
                // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏∏‡πà‡∏ô (Natural Sort ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ NT-1 ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô NT-10)
                const yearA = a.stu_year || '';
                const yearB = b.stu_year || '';
                const yearCompare = yearA.localeCompare(yearB, undefined, { numeric: true, sensitivity: 'base' });

                // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà 2: ‡∏ñ‡πâ‡∏≤‡∏£‡∏∏‡πà‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô -> ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• (‡∏Å-‡∏Æ)
                if (yearCompare === 0) {
                    return (a.fullname || '').localeCompare(b.fullname || '', 'th');
                }
                
                return yearCompare;
            });
        }

	function renderTable() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';

            const matches = getTableMatches(); // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
            const totalItems = matches.length;
            const totalPages = Math.ceil(totalItems / rowsProfile); // ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ rowsProfile
            
            if (pageProfile > totalPages && totalPages > 0) pageProfile = totalPages;
            if (pageProfile < 1) pageProfile = 1;

            const startIdx = (pageProfile - 1) * rowsProfile;
            const endIdx = startIdx + rowsProfile;
            const pageItems = matches.slice(startIdx, endIdx);

            pageItems.forEach(d => {
                // ... (‡πÇ‡∏Ñ‡πâ‡∏î Render tr ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏õ‡πä‡∏∞ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ) ...
                 const tr = `
                    <tr class="hover:bg-slate-50 transition border-b border-slate-50 last:border-0">
                        <td class="px-6 py-4 text-slate-600 font-medium">${d.stu_year || '-'}</td>
                        <td class="px-6 py-4 font-mono text-slate-500 font-semibold">${d.student_id || '-'}</td>
                        <td class="px-6 py-4 text-slate-800 font-medium whitespace-nowrap">${d.fullname || '-'}</td>
                        <td class="px-6 py-4 text-slate-500">${d.nickname || '-'}</td>
                        <td class="px-6 py-4 text-slate-500 text-xs">${d.healthcare_rights || '-'}</td>
                        <td class="px-6 py-4 text-slate-500 text-xs">${d.scholarship_province || '-'}</td>
                        <td class="px-6 py-4 text-slate-500 text-xs">${d.major || '-'}</td>
                        <td class="px-6 py-4 text-slate-500 text-xs">${d.university || '-'}</td>
                        <td class="px-6 py-4 text-center">
                            <span class="px-2.5 py-0.5 rounded-full text-xs font-semibold ${getStatusColor(d.studystatus)} whitespace-nowrap">${d.studystatus || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
                        </td>
                    </tr>
                `;

                tbody.insertAdjacentHTML('beforeend', tr);
            });

            // Update Controls (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ID ‡πÄ‡∏õ‡πá‡∏ô profile)
            document.getElementById('table-info-profile').innerText = totalItems > 0 
                ? `‡πÅ‡∏™‡∏î‡∏á ${startIdx + 1}-${Math.min(endIdx, totalItems)} ‡∏à‡∏≤‡∏Å ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`
                : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            document.getElementById('page-display-profile').innerText = `‡∏´‡∏ô‡πâ‡∏≤ ${totalPages > 0 ? pageProfile : 0} / ${totalPages}`;
            document.getElementById('btn-prev-profile').disabled = pageProfile === 1 || totalItems === 0;
            document.getElementById('btn-next-profile').disabled = pageProfile === totalPages || totalItems === 0;
        }

        // --- UTILS ---
        function countByGroup(data, field, limit = 0) {
            const counts = {};
            data.forEach(d => {
                let val = d[field];
                if(!val || val === '-' || val === '' || val === 'null') return;
                counts[val] = (counts[val] || 0) + 1;
            });
            const entries = Object.entries(counts).sort((a,b) => b[1] - a[1]);
            if(limit > 0) return Object.fromEntries(entries.slice(0, limit));
            return Object.fromEntries(entries);
        }

        function getStatusColor(status) {
            if(status === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤') return 'bg-blue-100 text-blue-700';
            if(status === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏ô') return 'bg-green-100 text-green-700';
            if(status === '‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤') return 'bg-purple-100 text-purple-700';
            if(status === '‡∏•‡∏≤‡∏≠‡∏≠‡∏Å') return 'bg-red-100 text-red-700';
            return 'bg-slate-100 text-slate-600';
        }

        function renderChart(id, options) {
            const baseOptions = {
                toolbar: { show: false },
                fontFamily: 'Sarabun, sans-serif',
                dataLabels: { enabled: false }
            };
            const finalOptions = { ...baseOptions, ...options, chart: { ...baseOptions.chart, ...options.chart } };
            
            if (charts[id]) {
                charts[id].updateOptions(finalOptions);
            } else {
                charts[id] = new ApexCharts(document.querySelector(`#${id}`), finalOptions);
                charts[id].render();
            }
        }
    </script>
</body>
</html>
